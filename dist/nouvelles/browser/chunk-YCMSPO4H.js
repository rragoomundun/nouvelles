import{a as D,b as Be}from"./chunk-TJBQAD2G.js";import{b as Y,c as U,d as z,e as J,f as K,g as j,h as Z,j as ee,k as te,o as ie,q as ne}from"./chunk-5IA6MI5F.js";import{a as Me}from"./chunk-Q5DBC3NA.js";import{a as be,b as Ve,c as ve}from"./chunk-LRA4C6LG.js";import{a as je}from"./chunk-ZZ5OVN5T.js";import{a as Q}from"./chunk-JJDFZKWJ.js";import{a as $}from"./chunk-67KAM2NX.js";import{$ as Te,$a as Ge,A as de,Aa as _e,Ba as ge,C as Oe,Ca as xe,D as Fe,Ea as m,F as w,Fa as C,G as T,Ga as g,Ha as ce,Ia as Re,Ja as Ae,La as W,Ma as Ne,Na as q,O as le,P as De,Pa as l,Q as ye,Qa as p,Ra as ke,T as r,U as we,W as d,X as x,Y as pe,Ya as Le,Za as me,aa as ue,cb as X,db as k,eb as $e,fb as L,ga as f,gb as F,ha as _,hb as O,ia as R,ib as he,ja as A,ka as N,kb as Ue,la as v,lb as G,ma as a,mb as M,na as s,nb as b,o as B,oa as h,sa as H,ua as P,wa as u,z as Pe,za as fe}from"./chunk-WH7ECZDW.js";var I=(()=>{let i=class i{constructor(t){this.http=t,this.API_PREFIX="forum"}getForumMeta(t){let n=`${this.API_PREFIX}/${t}/meta`;return this.http.get(n)}getDiscussions(t,n){let c=`${this.API_PREFIX}/${t}/discussions`,S={page:n};return this.http.get(c,{params:S})}getDiscussionMeta(t,n){return this.http.get(`${this.API_PREFIX}/${t}/discussion/${n}/meta`)}getDiscussionMessages(t,n){let c=`${this.API_PREFIX}/discussion/${t}/messages`,S={page:n};return this.http.get(c,{params:S,withCredentials:!0})}postDiscussion(t){return this.http.post(`${this.API_PREFIX}/discussion`,t,{withCredentials:!0})}postMessage(t,n){return this.http.post(`${this.API_PREFIX}/discussion/${t}`,n,{withCredentials:!0})}editMessage(t,n,c){return this.http.put(`${this.API_PREFIX}/discussion/${t}/message/${n}`,c,{withCredentials:!0})}likeMessage(t,n){return this.http.put(`${this.API_PREFIX}/discussion/${t}/message/${n}/like`,{},{withCredentials:!0})}dislikeMessage(t,n){return this.http.put(`${this.API_PREFIX}/discussion/${t}/message/${n}/dislike`,{},{withCredentials:!0})}deleteVote(t,n){return this.http.delete(`${this.API_PREFIX}/discussion/${t}/message/${n}/delete-vote`,{withCredentials:!0})}};i.\u0275fac=function(n){return new(n||i)(Oe(Ge))},i.\u0275prov=Pe({token:i,factory:i.\u0275fac,providedIn:"root"});let e=i;return e})();function nt(e,i){if(e&1&&(a(0,"a",1),m(1),s(),a(2,"span"),m(3,"\xA0>\xA0"),s()),e&2){let o=u().$implicit;v("routerLink",Re(o.link)),r(),C(o.label)}}function ot(e,i){if(e&1&&(a(0,"span",0),m(1),s()),e&2){let o=u().$implicit;r(),C(o.label)}}function rt(e,i){if(e&1&&(a(0,"li"),f(1,nt,4,3)(2,ot,2,1,"span",0),s()),e&2){let o=i.$index,t=i.$count;r(),_(o!==t-1?1:2)}}var He=(()=>{let i=class i{constructor(t){this.forumService=t}ngOnInit(){}};i.\u0275fac=function(n){return new(n||i)(d(I))},i.\u0275cmp=x({type:i,selectors:[["app-breadcrumb"]],decls:4,vars:0,consts:[[1,"active"],[3,"routerLink"]],template:function(n,c){n&1&&(a(0,"nav")(1,"ol"),A(2,rt,3,1,"li",null,R),s()()),n&2&&(r(2),N(c.forumService.breadcrumbItems))},dependencies:[O,F],styles:["ol[_ngcontent-%COMP%]{padding-left:0}ol[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline}ol[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], ol[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#555}ol[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   span.active[_ngcontent-%COMP%]{font-weight:700}ol[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}ol[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]});let e=i;return e})();var at=e=>["/forum",e,"discussion","nouvelle"];function ct(e,i){if(e&1&&(a(0,"a",4),h(1,"span",5),a(2,"span"),m(3),l(4,"translate"),s()()),e&2){let o=u();v("routerLink",Ne(4,at,o.forumSharedService.currentForum)),r(3),g("\xA0",p(4,2,"FORUM_COMMON.NEW_DISCUSSION"))}}var We=(()=>{let i=class i{constructor(t,n,c,S,E){this.router=t,this.translateService=n,this.userSharedService=c,this.forumService=S,this.forumSharedService=E}get onDiscussions(){return new RegExp("/forum/[^/]+$").test(this.router.url)}ngOnInit(){this.setCurrentForum(),this.routerEventsSubscription=this.router.events.pipe(B(t=>t instanceof X)).subscribe(()=>{this.setCurrentForum(),this.router.url==="/forum"&&(this.forumService.breadcrumbItems=[{label:this.translateService.instant("FORUM_PAGE.TITLE"),link:"/forum"}])}),this.router.url==="/forum"&&(this.forumService.breadcrumbItems=[{label:this.translateService.instant("FORUM_PAGE.TITLE"),link:"/forum"}])}ngOnDestroy(){this.routerEventsSubscription.unsubscribe()}setCurrentForum(){new RegExp("/forum/.+$").test(this.router.url)?this.forumSharedService.currentForum=this.router.url.split("/")[2].split("?")[0]:this.forumSharedService.currentForum=null}};i.\u0275fac=function(n){return new(n||i)(d(L),d(G),d(he),d(I),d(D))},i.\u0275cmp=x({type:i,selectors:[["app-forum"]],decls:7,vars:1,consts:[[1,"container"],[1,"row"],[1,"col"],[1,"col-auto","text-sm-end"],[3,"routerLink"],[1,"fa-solid","fa-circle-plus"]],template:function(n,c){n&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),h(3,"app-breadcrumb"),s(),a(4,"div",3),f(5,ct,5,6,"a",4),s()()(),h(6,"router-outlet")),n&2&&(r(5),_(c.onDiscussions&&c.userSharedService.isLoggedIn?5:-1))},dependencies:[O,$e,F,b,He,M],styles:[".container[_ngcontent-%COMP%]{padding-bottom:.5rem}.container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#555}.container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]});let e=i;return e})();function mt(e,i){e&1&&(a(0,"span"),m(1),l(2,"translate"),s()),e&2&&(r(),g(" 1 ",p(2,1,"GENERAL.DISCUSSION_LOWER")," "))}function dt(e,i){if(e&1&&(a(0,"span"),m(1),l(2,"translate"),s()),e&2){let o=u().$implicit;r(),ce(" ",o.nbDiscussions," ",p(2,2,"GENERAL.DISCUSSIONS_LOWER")," ")}}function lt(e,i){e&1&&(a(0,"span"),m(1),l(2,"translate"),s()),e&2&&(r(),g(" 1 ",p(2,1,"GENERAL.MESSAGE_LOWER")," "))}function pt(e,i){if(e&1&&(a(0,"span"),m(1),l(2,"translate"),s()),e&2){let o=u().$implicit;r(),ce(" ",o.nbMessages," ",p(2,2,"GENERAL.MESSAGES_LOWER")," ")}}function ut(e,i){if(e&1&&(a(0,"div",1)(1,"div",2)(2,"a",3),m(3),s()(),h(4,"div",4),a(5,"div",2)(6,"div"),f(7,mt,3,3,"span")(8,dt,3,4,"span"),s(),a(9,"div"),f(10,lt,3,3,"span")(11,pt,3,4,"span"),s()()()),e&2){let o=i.$implicit;r(2),v("routerLink",Ae("./",o.label)),r(),g(" ",o.name," "),r(4),_(o.nbDiscussions==="1"?7:8),r(3),_(o.nbMessages==="1"?10:11)}}var qe=(()=>{let i=class i{constructor(t,n){this.appSharedService=t,this.forumSharedService=n}ngOnInit(){this.appSharedService.setTitle("FORUM_PAGE.TITLE"),this.forumSharedService.setForums()}};i.\u0275fac=function(n){return new(n||i)(d($),d(D))},i.\u0275cmp=x({type:i,selectors:[["app-forum-list"]],decls:3,vars:0,consts:[[1,"container"],[1,"row"],[1,"col"],[3,"routerLink"],[1,"col-1","col-sm-4","col-md-6"]],template:function(n,c){n&1&&(a(0,"div",0),A(1,ut,12,5,"div",1,R),s()),n&2&&(r(),N(c.forumSharedService.forums))},dependencies:[O,F,b,M],styles:[".row[_ngcontent-%COMP%]{border-top:1px solid #ccc;padding:.5rem 0}.row[_ngcontent-%COMP%]:last-of-type{border-bottom:1px solid #ccc}.row[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%]:first-child{display:flex;align-items:center}.row[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%]:first-child   a[_ngcontent-%COMP%]{text-decoration:none}.row[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%]:first-child   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]});let e=i;return e})();var ft=(e,i)=>["discussion",e,i],_t=(e,i)=>["/profile",e,i];function gt(e,i){e&1&&(a(0,"p"),m(1),l(2,"translate"),s()),e&2&&(r(),C(p(2,1,"DISCUSSIONS_PAGE.NO_DISCUSSIONS")))}function ht(e,i){e&1&&(a(0,"span"),m(1),l(2,"translate"),s()),e&2&&(r(),C(p(2,1,"GENERAL.MESSAGE_LOWER")))}function vt(e,i){e&1&&(a(0,"span"),m(1),l(2,"translate"),s()),e&2&&(r(),C(p(2,1,"GENERAL.MESSAGES_LOWER")))}function St(e,i){if(e&1&&(a(0,"div",1)(1,"div",2)(2,"a",3),m(3),s(),h(4,"br")(5,"br"),a(6,"span"),m(7),l(8,"translate"),a(9,"a",4),m(10),s(),m(11," - "),a(12,"span"),m(13),s()()(),a(14,"div",5)(15,"div")(16,"span"),m(17),s(),f(18,ht,3,3,"span")(19,vt,3,3,"span"),s(),a(20,"div")(21,"span"),m(22),l(23,"translate"),s(),h(24,"br"),a(25,"span"),m(26),s()()()()),e&2){let o=i.$implicit,t=u();r(2),v("routerLink",q(14,ft,o.id,t.urlSharedService.toLowerURL(o.name))),r(),g(" ",o.name," "),r(4),g(" ",p(8,10,"DISCUSSIONS_PAGE.BY")," "),r(2),v("routerLink",q(17,_t,o.author.id,t.urlSharedService.toLowerURL(o.author.name))),r(),g(" ",o.author.name," "),r(3),C(o.firstMessageDateFormatted),r(4),g("",o.nbMessages,"\xA0"),r(),_(o.nbMessages==="1"?18:19),r(4),g("",p(23,12,"DISCUSSIONS_PAGE.LAST_MESSAGE")," :"),r(4),C(o.lastMessageDateFormatted)}}function Ct(e,i){if(e&1&&h(0,"br")(1,"app-pagination",6),e&2){let o=u();r(),v("nbPages",o.nbPages)}}var Qe=(()=>{let i=class i{constructor(t,n,c,S,E,se,ae,Ce){this.router=t,this.activatedRoute=n,this.translateService=c,this.appSharedService=S,this.forumSharedService=E,this.forumService=se,this.urlSharedService=ae,this.platformId=Ce}get page(){return Number(this.activatedRoute.snapshot.queryParams.page||"1")}ngOnInit(){this.forum=this.router.url.split("/")[2].split("?")[0],this.getMetaInformation(),this.getDiscussions(),this.forumSharedService.getForums().subscribe({next:t=>{let n=t.find(c=>c.label===this.forum).name;this.appSharedService.setTitle(`${n} - ${this.translateService.instant("FORUM_PAGE.TITLE")}`,!1),this.forumService.breadcrumbItems=[{label:this.translateService.instant("FORUM_PAGE.TITLE"),link:"/forum"},{label:n,link:`/forum/${this.forum}`}]}}),this.routerEventsSubscription=this.router.events.pipe(B(t=>t instanceof X)).subscribe(()=>{this.getDiscussions()})}ngOnDestroy(){this.routerEventsSubscription.unsubscribe()}getMetaInformation(){this.forumService.getForumMeta(this.forum).subscribe({next:t=>{this.nbPages=t.nbPages}})}getDiscussions(){this.forumService.getDiscussions(this.forum,this.page).subscribe({next:t=>{this.discussions=t,this.discussions.length===0&&(this.noDiscussions=!0);for(let n of this.discussions)n.firstMessageDateFormatted=be.fromISO(n.firstMessageDate).toFormat("dd/LL/yyyy, HH:mm"),n.lastMessageDateFormatted=be.fromISO(n.lastMessageDate).toFormat("dd/LL/yyyy, HH:mm");me(this.platformId)&&setTimeout(()=>window.scrollTo({top:0,behavior:"instant"}))}})}};i.\u0275fac=function(n){return new(n||i)(d(L),d(k),d(G),d($),d(D),d(I),d(Q),d(le))},i.\u0275cmp=x({type:i,selectors:[["app-discussions"]],decls:5,vars:2,consts:[[1,"container"],[1,"row"],[1,"col","col-sm-8","col-md-8","col-lg-8"],[3,"routerLink"],[1,"content-link",3,"routerLink"],[1,"col"],[3,"nbPages"]],template:function(n,c){n&1&&(a(0,"div",0),f(1,gt,3,3,"p"),A(2,St,27,20,"div",1,R),f(4,Ct,2,1),s()),n&2&&(r(),_(c.noDiscussions?1:-1),r(),N(c.discussions),r(2),_(c.nbPages?4:-1))},dependencies:[ve,b,O,F,M],styles:[".row[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%]:last-of-type{text-align:end}.row[_ngcontent-%COMP%]{border-top:1px solid #ccc;padding:.5rem 0}.row[_ngcontent-%COMP%]:last-of-type{border-bottom:1px solid #ccc}a[_ngcontent-%COMP%]{text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]});let e=i;return e})();var xt=()=>["false","error"];function Mt(e,i){if(e&1&&(a(0,"button",9),m(1),l(2,"translate"),s()),e&2){let o=u();v("disabled",o.isFormValid===!1),r(),g(" ",p(2,2,"GENERAL.CREATE")," ")}}function bt(e,i){e&1&&(a(0,"button",9),h(1,"span",11),m(2),l(3,"translate"),s()),e&2&&(v("disabled",!0),r(2),g(" ",p(3,2,"GENERAL.CREATION")," "))}function It(e,i){e&1&&(a(0,"div",10)(1,"span"),m(2),l(3,"translate"),s()()),e&2&&(r(2),C(p(3,1,"NEW_DISCUSSION_PAGE.ERRORS.CREATION")))}var ze=(()=>{let i=class i{constructor(t,n,c,S,E,se,ae){this.activatedRoute=t,this.router=n,this.translateService=c,this.appSharedService=S,this.forumService=E,this.forumSharedService=se,this.urlSharedService=ae}get isFormValid(){return this.discussionForm.valid}ngOnInit(){this.appSharedService.setTitle("FORUM_COMMON.NEW_DISCUSSION"),this.discussionForm=new K({name:new j("",[U.required]),message:new j("",[U.required])}),this.forumService.breadcrumbItems=[{label:this.translateService.instant("FORUM_PAGE.TITLE"),link:"/forum"},{label:this.forumSharedService.currentForumName,link:`/forum/${this.forumSharedService.currentForum}`},{label:this.translateService.instant("FORUM_COMMON.NEW_DISCUSSION"),link:this.router.url}],this.onCreation="false"}onSubmit(){let t={name:this.discussionForm.controls.name.value,message:this.discussionForm.controls.message.value,forum:this.activatedRoute.snapshot.params.forum};this.onCreation="true",this.forumService.postDiscussion(t).subscribe({next:n=>{let{id:c}=n,S=`/forum/${t.forum}/discussion/${c}/${this.urlSharedService.toLowerURL(t.name)}`;this.router.navigate([S])},error:()=>{this.onCreation="error"}})}};i.\u0275fac=function(n){return new(n||i)(d(k),d(L),d(G),d($),d(I),d(D),d(Q))},i.\u0275cmp=x({type:i,selectors:[["app-new-discussion"]],decls:19,vars:14,consts:[[1,"container"],[1,"title"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","name",1,"form-label"],["id","name","type","text","formControlName","name","required","",1,"form-control"],["for","message",1,"form-label"],["id","message","cols","30","rows","10","formControlName","message","required","",1,"form-control"],[1,"text-end"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"text-end","text-danger","mt-3"],[1,"fa-solid","fa-spinner","fa-spin"]],template:function(n,c){n&1&&(a(0,"div",0)(1,"h2",1),m(2),l(3,"translate"),s(),a(4,"form",2),P("ngSubmit",function(){return c.onSubmit()}),a(5,"div",3)(6,"label",4),m(7),l(8,"translate"),s(),h(9,"input",5),s(),a(10,"div",3)(11,"label",6),m(12),l(13,"translate"),s(),h(14,"textarea",7),s(),a(15,"div",8),f(16,Mt,3,4,"button",9),f(17,bt,4,4,"button",9),s(),f(18,It,4,3,"div",10),s()()),n&2&&(r(2),C(p(3,7,"FORUM_COMMON.NEW_DISCUSSION")),r(2),v("formGroup",c.discussionForm),r(3),g(" ",p(8,9,"NEW_DISCUSSION_PAGE.NAME")," "),r(5),g(" ",p(13,11,"NEW_DISCUSSION_PAGE.FIRST_MESSAGE")," "),r(4),_(W(13,xt).includes(c.onCreation)?16:-1),r(),_(c.onCreation==="true"?17:-1),r(),_(c.onCreation==="error"?18:-1))},dependencies:[b,ne,Z,Y,z,J,ie,ee,te,M],encapsulation:2});let e=i;return e})();var Et=()=>["false","success","error"];function Pt(e,i){if(e&1&&(a(0,"button",5),m(1),l(2,"translate"),s()),e&2){let o=u();v("disabled",o.isFormValid===!1),r(),g(" ",p(2,2,"DISCUSSION_PAGE.ANSWER")," ")}}function Ot(e,i){e&1&&(a(0,"button",5),h(1,"span",7),m(2),l(3,"translate"),s()),e&2&&(v("disabled",!0),r(2),g(" ",p(3,2,"DISCUSSION_PAGE.ANSWERING")," "))}function Ft(e,i){e&1&&(a(0,"div",6)(1,"span"),m(2),l(3,"translate"),s()()),e&2&&(r(2),C(p(3,1,"DISCUSSION_PAGE.ERRORS.ANSWERING")))}var Je=(()=>{let i=class i{constructor(t,n){this.activatedRoute=t,this.forumService=n,this.answered=new ue}get isFormValid(){return this.answerForm.valid}ngOnInit(){this.answerForm=new K({message:new j("",[U.required])}),this.onAnswer="false"}onSubmit(){let t=this.activatedRoute.snapshot.params.discussionId,n=this.answerForm.value;this.onAnswer="true",this.forumService.postMessage(t,n).subscribe({complete:()=>{this.answerForm.controls.message.setValue(""),this.onAnswer="success",this.answered.emit()},error:()=>{this.onAnswer="error"}})}};i.\u0275fac=function(n){return new(n||i)(d(k),d(I))},i.\u0275cmp=x({type:i,selectors:[["app-answer-discussion"]],outputs:{answered:"answered"},decls:11,vars:8,consts:[[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","message",1,"form-label"],["id","message","cols","30","rows","10","formControlName","message","required","",1,"form-control"],[1,"text-end"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"text-end","text-danger","mt-3"],[1,"fa-solid","fa-spinner","fa-spin"]],template:function(n,c){n&1&&(h(0,"hr"),a(1,"form",0),P("ngSubmit",function(){return c.onSubmit()}),a(2,"div",1)(3,"label",2),m(4),l(5,"translate"),s(),h(6,"textarea",3),s(),a(7,"div",4),f(8,Pt,3,4,"button",5),f(9,Ot,4,4,"button",5),s(),f(10,Ft,4,3,"div",6),s()),n&2&&(r(),v("formGroup",c.answerForm),r(3),g(" ",p(5,5,"DISCUSSION_PAGE.ANSWER_DISCUSSION")," "),r(4),_(W(7,Et).includes(c.onAnswer)?8:-1),r(),_(c.onAnswer==="true"?9:-1),r(),_(c.onAnswer==="error"?10:-1))},dependencies:[b,ne,Z,Y,z,J,ie,ee,te,M],encapsulation:2});let e=i;return e})();var Dt=["content"],yt=()=>["false","success","error"];function wt(e,i){if(e&1&&(a(0,"button",9),m(1),l(2,"translate"),s()),e&2){let o=u(2);v("disabled",o.isFormValid===!1),r(),g(" ",p(2,2,"DISCUSSION_PAGE.EDIT")," ")}}function Tt(e,i){e&1&&(a(0,"button",9),h(1,"span",11),m(2),l(3,"translate"),s()),e&2&&(v("disabled",!0),r(2),g(" ",p(3,2,"DISCUSSION_PAGE.EDITING")," "))}function Rt(e,i){e&1&&(a(0,"div",10)(1,"span"),m(2),l(3,"translate"),s()()),e&2&&(r(2),C(p(3,1,"DISCUSSION_PAGE.ERRORS.EDIT")))}function At(e,i){if(e&1){let o=H();a(0,"form",1),P("ngSubmit",function(){w(o);let n=u();return T(n.onSubmit())}),a(1,"div",2)(2,"h4",3),m(3),l(4,"translate"),s(),a(5,"button",4),P("click",function(){let n=w(o).$implicit;return T(n.dismiss())}),s()(),a(6,"div",5)(7,"label",6),m(8),l(9,"translate"),s(),h(10,"textarea",7),s(),a(11,"div",8)(12,"div"),f(13,wt,3,4,"button",9),f(14,Tt,4,4,"button",9),s(),f(15,Rt,4,3,"div",10),s()()}if(e&2){let o=u();v("formGroup",o.messageForm),r(3),g(" ",p(4,6,"DISCUSSION_PAGE.EDIT_MESSAGE")," "),r(5),g(" ",p(9,8,"DISCUSSION_PAGE.MESSAGE")," "),r(5),_(W(10,yt).includes(o.onEdit)?13:-1),r(),_(o.onEdit==="true"?14:-1),r(),_(o.onEdit==="error"?15:-1)}}var Ee=(()=>{let i=class i{constructor(t){this.forumService=t,this.modalService=Fe(Be),this.modified=new ue}get isFormValid(){return this.messageForm.valid}ngOnInit(){this.messageForm=new K({message:new j("",[U.required])}),this.onEdit="false"}open(t,n,c){this.discussionId=t,this.messageId=n,this.messageForm.controls.message.setValue(c),this.modalService.open(this.contentTemplate,{size:"lg"})}onSubmit(){this.onEdit="true",this.forumService.editMessage(this.discussionId,this.messageId,this.messageForm.value).subscribe({complete:()=>{this.onEdit="success",this.modalService.dismissAll(),this.modified.emit({messageId:this.messageId,message:this.messageForm.value.message,date:new Date})},error:()=>{this.onEdit="error"}})}};i.\u0275fac=function(n){return new(n||i)(d(I))},i.\u0275cmp=x({type:i,selectors:[["app-edit-message"]],viewQuery:function(n,c){if(n&1&&fe(Dt,5,we),n&2){let S;_e(S=ge())&&(c.contentTemplate=S.first)}},outputs:{modified:"modified"},decls:2,vars:0,consts:[["content",""],[3,"ngSubmit","formGroup"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["for","message",1,"form-label"],["id","message","type","text","cols","30","rows","10","formControlName","message","required","",1,"form-control"],[1,"modal-footer"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"text-end","text-danger","mt-3"],[1,"fa-solid","fa-spinner","fa-spin"]],template:function(n,c){n&1&&Te(0,At,16,11,"ng-template",null,0,ke)},dependencies:[b,ne,Z,Y,z,J,ie,ee,te,M],styles:[".modal-footer[_ngcontent-%COMP%]   .text-end.text-danger[_ngcontent-%COMP%]{width:100%}"]});let e=i;return e})();var Ke=(e,i)=>["/profile",e,i];function Nt(e,i){e&1&&h(0,"app-not-found")}function kt(e,i){if(e&1&&h(0,"img",4),e&2){let o=u().$implicit;v("src",o.author.image,ye)("alt",o.author.name)}}function Lt(e,i){e&1&&h(0,"span",5)}function Gt(e,i){if(e&1&&(a(0,"span",14),m(1,"\xA0\xB7\xA0"),s(),a(2,"span",14),m(3),l(4,"translate"),s()),e&2){let o=u().$implicit;r(3),ce("",p(4,2,"GENERAL.DATE.UPDATED")," : ",o.updatedDateFormatted," ")}}function $t(e,i){if(e&1){let o=H();a(0,"span",15),P("click",function(){w(o);let n=u().$implicit,c=u(2);return T(c.onEditClick(n.id,n.content))}),h(1,"span",16),a(2,"span"),m(3),l(4,"translate"),s()()}e&2&&(r(3),g("\xA0",p(4,1,"DISCUSSION_PAGE.EDIT")))}function Ut(e,i){if(e&1&&m(0),e&2){let o=u().$implicit;g(" ",o.nbLikes," ")}}function jt(e,i){if(e&1&&m(0),e&2){let o=u().$implicit;g(" ",o.nbDislikes," ")}}function Vt(e,i){if(e&1){let o=H();a(0,"div",1)(1,"div",2)(2,"a",3),f(3,kt,1,2,"img",4)(4,Lt,1,0,"span",5),s()(),a(5,"div",6)(6,"div",7)(7,"a",8),m(8),s(),a(9,"span"),m(10,"\xA0\xB7\xA0"),s(),a(11,"span"),m(12),s(),f(13,Gt,5,4),s(),h(14,"div",9),a(15,"div",10)(16,"div"),f(17,$t,5,3,"span"),s(),a(18,"div")(19,"span",11),P("click",function(){let n=w(o).$implicit,c=u(2);return T(c.onThumbUpClick(n))}),h(20,"span",12),a(21,"span"),f(22,Ut,1,1),s()(),a(23,"span",11),P("click",function(){let n=w(o).$implicit,c=u(2);return T(c.onThumbDownClick(n))}),h(24,"span",13),a(25,"span"),f(26,jt,1,1),s()()()()()()}if(e&2){let o=i.$implicit,t=u(2);v("id","message-"+o.id),r(2),v("routerLink",q(15,Ke,o.author.id,t.urlSharedService.toLowerURL(o.author.name))),r(),_(o.author.image?3:4),r(4),v("routerLink",q(18,Ke,o.author.id,t.urlSharedService.toLowerURL(o.author.name))),r(),g(" ",o.author.name," "),r(4),C(o.dateFormatted),r(),_(o.updatedDateFormatted?13:-1),r(),v("innerHTML",o.contentFormatted,De),r(3),_(t.userSharedService.isLoggedIn&&t.userSharedService.id===o.author.id?17:-1),r(3),xe("text-success",o.vote&&o.vote==="like"),r(2),_(o.nbLikes?22:-1),r(2),xe("text-danger",o.vote&&o.vote==="dislike"),r(2),_(o.nbDislikes?26:-1)}}function Bt(e,i){if(e&1&&h(0,"br")(1,"app-pagination",17),e&2){let o=u(2);r(),v("nbPages",o.nbPages)}}function Ht(e,i){if(e&1){let o=H();a(0,"app-answer-discussion",18),P("answered",function(){w(o);let n=u(2);return T(n.onNewAnswer())}),s(),a(1,"app-edit-message",19),P("modified",function(n){w(o);let c=u(2);return T(c.onEditMessage(n))}),s()}}function Wt(e,i){if(e&1&&(a(0,"h2"),m(1),s(),A(2,Vt,27,21,"div",1,R),f(4,Bt,2,1),f(5,Ht,2,0)),e&2){let o=u();r(),C(o.name),r(),N(o.messages),r(2),_(o.nbPages?4:-1),r(),_(o.userSharedService.isLoggedIn?5:-1)}}var Ze=(()=>{let i=class i{constructor(t,n,c,S,E,se,ae,Ce,tt,it){this.router=t,this.activatedRoute=n,this.translateService=c,this.appSharedService=S,this.forumService=E,this.forumSharedService=se,this.dateSharedService=ae,this.userSharedService=Ce,this.urlSharedService=tt,this.platformId=it,this.MESSAGES_PER_PAGE=20}get page(){return Number(this.activatedRoute.snapshot.queryParams.page||"1")}ngOnInit(){this.forum=this.activatedRoute.snapshot.params.forum,this.id=this.activatedRoute.snapshot.params.discussionId,me(this.platformId)&&(this.getMetaInformation(),this.getMessages()),this.routerEventsSubscription=this.router.events.pipe(B(t=>t instanceof X)).subscribe(()=>{this.getMessages()})}ngOnDestroy(){this.routerEventsSubscription.unsubscribe()}getMetaInformation(){this.forumService.getDiscussionMeta(this.forum,this.id).subscribe({next:t=>{this.name=t.name,this.nbPages=t.nbPages,this.notFound=!1,this.appSharedService.setTitle(`${this.name} - ${this.translateService.instant("FORUM_PAGE.TITLE")}`,!1),this.forumService.breadcrumbItems=[{label:this.translateService.instant("FORUM_PAGE.TITLE"),link:"/forum"},{label:this.forumSharedService.currentForumName,link:`/forum/${this.forumSharedService.currentForum}`},{label:this.name,link:this.router.url}]},error:t=>{let{type:n}=t.error;n&&n==="DISCUSSION_INCORRECT"&&(this.notFound=!0)}})}getMessages(t=!0){this.forumService.getDiscussionMessages(this.id,this.page).subscribe({next:n=>{this.messages=n;for(let c of this.messages){c.contentFormatted=Me.parse(c.content);let S=new Date(c.date);if(c.dateFormatted=this.dateSharedService.dt.set({day:S.getDate(),month:S.getMonth()+1,year:S.getFullYear(),hour:S.getHours(),minute:S.getMinutes()}).toFormat("dd MMMM yyyy, HH:mm"),c.updatedDate){let E=new Date(c.updatedDate);c.updatedDateFormatted=this.dateSharedService.dt.set({day:E.getDate(),month:E.getMonth()+1,year:E.getFullYear(),hour:E.getHours(),minute:E.getMinutes()}).toFormat("dd MMMM yyyy, HH:mm")}}if(me(this.platformId)){let c=this.router.url.split("#")[1];c?setTimeout(()=>{document.getElementById(c)?.scrollIntoView({behavior:"instant"}),window.scrollBy({top:-100,behavior:"instant"})}):t&&setTimeout(()=>window.scrollTo({top:0,behavior:"instant"}))}}})}onNewAnswer(){if(this.messages.length===this.MESSAGES_PER_PAGE){let t=this.router.url.split("?")[0];this.nbPages++,this.router.navigate([t],{queryParams:{page:this.page+1}})}else this.getMessages(!1)}onEditMessage(t){let n=this.messages.find(c=>c.id===t.messageId);n.contentFormatted=Me.parse(t.message),n.updatedDateFormatted=this.dateSharedService.dt.set({day:t.date.getDate(),month:t.date.getMonth()+1,year:t.date.getFullYear(),hour:t.date.getHours(),minute:t.date.getMinutes()}).toFormat("dd MMMM yyyy, HH:mm")}onEditClick(t,n){this.editMessageComponent.open(this.id,t,n)}onThumbUpClick(t){this.userSharedService.isLoggedIn&&(t.vote&&t.vote==="like"?this.forumService.deleteVote(this.id,t.id).subscribe({complete:()=>{t.vote=null,t.nbLikes--}}):this.forumService.likeMessage(this.id,t.id).subscribe({complete:()=>{t.vote&&t.vote==="dislike"&&t.nbDislikes--,t.vote="like",t.nbLikes++}}))}onThumbDownClick(t){this.userSharedService.isLoggedIn&&(t.vote&&t.vote==="dislike"?this.forumService.deleteVote(this.id,t.id).subscribe({complete:()=>{t.vote=null,t.nbDislikes--}}):this.forumService.dislikeMessage(this.id,t.id).subscribe({complete:()=>{t.vote&&t.vote==="like"&&t.nbLikes--,t.vote="dislike",t.nbDislikes++}}))}};i.\u0275fac=function(n){return new(n||i)(d(L),d(k),d(G),d($),d(I),d(D),d(Ve),d(he),d(Q),d(le))},i.\u0275cmp=x({type:i,selectors:[["app-discussion"]],viewQuery:function(n,c){if(n&1&&fe(Ee,5),n&2){let S;_e(S=ge())&&(c.editMessageComponent=S.first)}},decls:3,vars:1,consts:[[1,"container"],[1,"d-flex","message",3,"id"],[1,"d-none","d-sm-block"],[3,"routerLink"],[3,"src","alt"],[1,"fa-regular","fa-circle-user","fa-2x"],[1,"message-box"],[1,"message-header"],[1,"content-link",3,"routerLink"],[1,"message-content",3,"innerHTML"],[1,"message-footer"],[1,"thumb",3,"click"],[1,"fa-solid","fa-thumbs-up"],[1,"fa-solid","fa-thumbs-down"],[1,"d-none","d-md-inline"],[3,"click"],[1,"fa-solid","fa-pen"],[3,"nbPages"],[3,"answered"],[3,"modified"]],template:function(n,c){n&1&&(a(0,"div",0),f(1,Nt,1,0,"app-not-found")(2,Wt,6,3),s()),n&2&&(r(),_(c.notFound?1:c.notFound===!1?2:-1))},dependencies:[O,F,b,ve,Je,Ee,je,M],styles:[".container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:1rem}.container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .d-none.d-sm-block[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}.container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .d-none.d-sm-block[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:48px;height:48px;object-fit:cover;border:1px solid #ccc;border-radius:100%;margin-right:1rem}.container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .d-none.d-sm-block[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:48px;height:48px;border:1px solid #ccc;border-radius:100%;margin-right:1rem;color:#333}.container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]{border:1px solid #ccc;border-radius:.5rem;margin-bottom:1rem;padding:.5rem;width:100%}.container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]   .message-header[_ngcontent-%COMP%]{border-bottom:1px solid #ccc;padding-bottom:.5rem;margin-bottom:.5rem}.container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]   .message-footer[_ngcontent-%COMP%]{display:flex}.container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]   .message-footer[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:50%}.container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]   .message-footer[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{color:#555}.container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]   .message-footer[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]:hover{cursor:pointer}.container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]   .message-footer[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-of-type{text-align:end;color:#666}.container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]   .message-footer[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-of-type   .thumb[_ngcontent-%COMP%]{cursor:pointer}.container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]   .message-footer[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-of-type   .thumb[_ngcontent-%COMP%]   .fa-solid[_ngcontent-%COMP%]{margin-right:.25rem;margin-left:.5rem}"]});let e=i;return e})();var qt=[{path:"",component:We,children:[{path:"",component:qe},{path:":forum",children:[{path:"",component:Qe},{path:"discussion",children:[{path:"nouvelle",component:ze,canActivate:[Ue]},{path:":discussionId/:discussionTitle",component:Ze}]}]}]}],et=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=pe({type:i}),i.\u0275inj=de({imports:[O.forChild(qt),O]});let e=i;return e})();var nn=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=pe({type:i}),i.\u0275inj=de({imports:[Le,et]});let e=i;return e})();export{nn as ForumModule};
